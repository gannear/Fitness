var isGallery=!1;appcamera=function(a,b,c,d){var e="undefined"!=typeof appcamera?appcamera:{};return e.init=function(){e.el={$body:c("body"),$title:c("#appp_cam_post_title"),$file:c("#appp_cam_file"),$status:c("#cam_status")},jQuery("#capture-photo-btn").hasClass("btn-camera")?(jQuery("#capture-photo-btn").on("click",e.capturePhoto),jQuery("#photo-library-btn").on("click",e.photoLibrary)):(jQuery("#capture-photo-btn").on("click",e.attachPhoto),jQuery("#photo-library-btn").on("click",e.attachLibrary)),e.el.$body.on("change","#appp_cam_file",function(a){a.preventDefault();var b=c(this),d=e.el.$title.val();if(!d||!d.trim()){var f=b.val(),g=f?f.split("."):!1;g[0]&&(g=g[0].split("\\"),f=g[g.length-1],e.el.$title.val(f))}})},e.capturePhoto=function(){isGallery=!1,a.navigator.camera.getPicture(e.uploadPhoto,function(a){"function"==typeof apppresser.log&&apppresser.log("No photo was taken from the camera.","appp-camera.js, line 35")},{quality:30,destinationType:a.navigator.camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1204,targetHeight:1204})},e.photoLibrary=function(){isGallery=!0,a.navigator.camera.getPicture(e.uploadPhoto,function(a){"function"==typeof apppresser.log&&apppresser.log("No photo was added from the library.","appp-camera.js, line 53")},{quality:30,destinationType:a.navigator.camera.DestinationType.FILE_URI,sourceType:a.navigator.camera.PictureSourceType.PHOTOLIBRARY,correctOrientation:!0,targetWidth:1204,targetHeight:1204})},e.statusDom=function(){return e.statusDomEl=e.statusDomEl?e.statusDomEl:b.getElementById("cam-status"),e.statusDomEl},e.uploadPhoto=function(a){var c=a.substr(a.lastIndexOf("/")+1),d=(c.split("?")[0],c.split("?")[1]);"Android"===device.platform&&isGallery&&(c=d+".jpg"),console.log(c);var f=new FileUploadOptions;f.fileKey="appp_cam_file",f.fileName=a?c:"",f.mimeType="image/jpeg",console.log(f);var g,h={},i=[],j=[],k=b.appp_camera_form.elements;for(g=0;g<k.length;g++)i[g]=k[g].name,j[g]=k[g].value;h.form_fields=JSON.stringify(i),h.form_values=JSON.stringify(j),b.getElementById("appp_cam_post_title").value="",f.params=h;var l=new FileTransfer;apppCore.noGoBackFlag=!0,l.upload(a,encodeURI(b.URL),e.win,e.fail,f),l.onprogress=function(a){if(a.lengthComputable){jQuery("#cam-progress").css("visibility","visible");var c=Math.floor(a.loaded/a.total*100);b.getElementById("progress").value=c}else""===e.statusDom().innerHTML?e.statusDom().innerHTML=e.msg.loading:e.statusDom().innerHTML+="."}},e.win=function(a){var c=e.msg.moderation;b.getElementById("appp_action").value;e.moderation_on||(c=e.msg.success),jQuery("#cam-status").html("<p>"+c+"</p>"),jQuery("#cam-progress").css("visibility","hidden")},e.fail=function(a){console.log("upload error source "+a.source),console.log("upload error target "+a.target),jQuery("#cam-status").html("<p>"+e.msg.error+"= "+a.code+"</p>"),jQuery("#cam-progress").css("visibility","hidden")},e.attachPhoto=function(){a.navigator.camera.getPicture(e.uploadAttachPhoto,function(a){"function"==typeof apppresser.log&&apppresser.log("No photo was added from the library.","appp-camera.js, line 53")},{quality:30,destinationType:a.navigator.camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1204,targetHeight:1204})},e.attachLibrary=function(){apppCore.noGoBackFlag=!0,a.navigator.camera.getPicture(e.uploadAttachPhoto,function(a){"function"==typeof apppresser.log&&apppresser.log("No photo was added from the library.","appp-camera.js, line 53")},{quality:30,destinationType:a.navigator.camera.DestinationType.FILE_URI,sourceType:a.navigator.camera.PictureSourceType.PHOTOLIBRARY,correctOrientation:!0,targetWidth:1204,targetHeight:1204})},e.uploadAttachPhoto=function(a){console.log(a);var c="",d=a.substr(a.lastIndexOf("/")+1),f=d.split("?")[0],g=d.split("?")[1],h=Math.floor(Date.now()/1e3);g="undefined"==typeof g?h-1:g,c=h+"-"+f,"Android"===device.platform&&(c=g+h+".jpg"),console.log(c);var i=new FileUploadOptions;i.fileKey="appp_cam_file",i.fileName=a?c:"",i.mimeType="image/jpeg",i.appp_action="attach";var j={};j.action="upload_image",b.getElementById("apppcamera-upload-image")?j.nonce=b.getElementById("apppcamera-upload-image").value:b.getElementById("attach-photo")&&(j.nonce=b.getElementById("attach-photo").getAttribute("data-nonce")),i.params=j;var k=new FileTransfer;k.upload(a,ajaxurl,e.attachWin,e.fail,i),k.onprogress=function(a){if(a.lengthComputable){jQuery("#cam-progress").css("visibility","visible");var c=Math.floor(a.loaded/a.total*100);b.getElementById("progress").value=c}else""===e.statusDom().innerHTML?e.statusDom().innerHTML=e.msg.loading:e.statusDom().innerHTML+="."}},e.attachWin=function(a){var c="Nonce Failed";console.log("Code = "+a.responseCode),console.log("Response = "+a.response),console.log("Sent = "+a.bytesSent);var d=b.getElementById("appp_action").value;"appbuddy"==d&&(a.response==c?msg="Nonce failed":msg="Image attached"),jQuery("#cam-status").html("<p>"+msg+"</p>"),a.response!=c&&(b.getElementById("attach-image").value=JSON.parse(a.response)),jQuery("#attach-image-sheet").removeClass("active").addClass("hide"),a.response!=c&&jQuery("#image-status").html('<img src="'+JSON.parse(a.response)+'">'),jQuery("#cam-progress").css("visibility","hidden"),jQuery("#cam-status").html("")},e}(window,document,jQuery),jQuery(document).ready(appcamera.init).bind("load_ajax_content_done",appcamera.init);