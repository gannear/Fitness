window.appcamera={Attachment:{},AllAttachments:{},Views:{}},function(a,b,c,d){appData=a.appCamAdmin,appcam=a.appcamera,appcam.updateCount=function(a){this.$menu=this.$menu||c(".toplevel_page_apppresser_settings"),a=a?parseFloat(a):0;var b=this.$menu.find(".update-plugins");a?(b.attr("class","update-plugins count-"+a),c("span",b).text(a)):b.remove()},appcam.Attachment=Backbone.Model.extend({defaults:{url:"",date:"",mime:"",title:"",thumb:"",post_id:"",editLink:"",approved:!1,authorURL:"",authorName:"",parentTitle:"",parentEditURL:""},url:function(){var b=this.get("approved")?"approve":"deny",c=a.ajaxurl+"?action="+appData.action+"&id="+encodeURIComponent(this.id)+"&approved="+encodeURIComponent(b);return c}}),appcam.AllAttachments=Backbone.Collection.extend({model:appcam.Attachment}),appcam.Views.Table=Backbone.View.extend({initialize:function(){var b=this;this._rows=[],this.collection.each(function(a){b._rows.push(new appcam.Views.Row({model:a}))}),this._rows.length||(c(".no-photos").text(c(".no-photos").text()+appData.redirected),setTimeout(function(){a.location.href=appData.settingsURL},2500)),this.render(),this.listenTo(this.collection,"remove",this.checkEmpty)},checkEmpty:function(){this.collection.length||this.$el.parents(".have-photos").after("<p>"+appData.no_photos+"</p>").remove(),appcam.updateCount(this.collection.length)},render:function(){this.$el.empty();var a=b.createDocumentFragment();_.each(this._rows,function(b){a.appendChild(b.render().el)}),this.$el.append(a)}}),appcam.Views.Row=Backbone.View.extend({tagName:"tr",template:wp.template(appData.rowTemplate),spinner:"",events:{"click .row-actions .edit a":"approve","click .row-actions .delete a":"removeIt"},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.spinner=this.$el.find(".spinner"),this},approve:function(a){a.preventDefault(),this.spinner.show(),this.model.set("approved",!0),this.removeIt(a)},removeIt:function(a){a.preventDefault();var b=this,c=b.$el.find(".file-error"),d=function(a,d){b.log("destroyError",d),b.spinner.hide(),c.show(),b.$el.fadeIn(300)},e=function(a,c){c.success?(b.log("destroySuccess",c),b.spinner.hide(),b.$el.remove()):d(a,c)};b.spinner.show(),c.hide(),b.$el.fadeOut(300),this.model.destroy({success:e,error:d,wait:!0})},log:function(a){"use strict";console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}),function(){var a=new appcam.AllAttachments(appData.attachments);new appcam.Views.Table({collection:a,el:appData.tableTemplate})}()}(window,document,jQuery);